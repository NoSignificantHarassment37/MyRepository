{
  "version": 3,
  "sources": ["../../../src/pages/DetalleVentas.ts"],
  "sourcesContent": ["// api.ts\r\nexport const apiUrl = \"api/detalleventas\";\r\n\r\n// --- Tipos ---\r\ninterface DetalleVenta {\r\n    detalleVentaId: number;\r\n    ventaId: number;\r\n    productoId: number;\r\n    cantidad: number;\r\n    subtotal: number;\r\n}\r\n\r\n// --- Referencias DOM ---\r\nconst form = document.getElementById(\"detalle-form\") as HTMLFormElement;\r\nconst tbody = document.getElementById(\"detalles-tbody\") as HTMLTableSectionElement;\r\nconst inputId = document.getElementById(\"detalle-id\") as HTMLInputElement;\r\nconst inputVentaId = document.getElementById(\"ventaId\") as HTMLInputElement;\r\nconst inputProductoId = document.getElementById(\"productoId\") as HTMLInputElement;\r\nconst inputCantidad = document.getElementById(\"cantidad\") as HTMLInputElement;\r\nconst inputSubtotal = document.getElementById(\"subtotal\") as HTMLInputElement;\r\n\r\n// --- Listeners ---\r\ndocument.addEventListener(\"DOMContentLoaded\", loadDetalles);\r\nform.addEventListener(\"submit\", handleSubmit);\r\n\r\n// --- Funciones ---\r\nasync function loadDetalles(): Promise<void> {\r\n    try {\r\n        const res = await fetch(apiUrl);\r\n        if (!res.ok) throw new Error(\"Error al obtener detalles\");\r\n\r\n        const detalles: DetalleVenta[] = await res.json();\r\n\r\n        tbody.innerHTML = \"\";\r\n\r\n        for (const d of detalles) {\r\n            const row = document.createElement(\"tr\");\r\n            row.innerHTML = `\r\n                <td>${d.detalleVentaId}</td>\r\n                <td>${d.ventaId}</td>\r\n                <td>${d.productoId}</td>\r\n                <td>${d.cantidad}</td>\r\n                <td>${d.subtotal.toFixed(2)}</td>\r\n                <td>\r\n                    <button class=\"editar\">Editar</button>\r\n                    <button class=\"eliminar\">Eliminar</button>\r\n                </td>\r\n            `;\r\n\r\n            const btnEditar = row.querySelector(\".editar\") as HTMLButtonElement;\r\n            const btnEliminar = row.querySelector(\".eliminar\") as HTMLButtonElement;\r\n\r\n            btnEditar.addEventListener(\"click\", () => editDetalle(d));\r\n            btnEliminar.addEventListener(\"click\", () => deleteDetalle(d.detalleVentaId));\r\n\r\n            tbody.appendChild(row);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error cargando detalles:\", error);\r\n    }\r\n}\r\n\r\nasync function handleSubmit(event: SubmitEvent): Promise<void> {\r\n    event.preventDefault();\r\n\r\n    const id = inputId.value ? parseInt(inputId.value) : null;\r\n    const data: Omit<DetalleVenta, \"detalleVentaId\"> = {\r\n        ventaId: parseInt(inputVentaId.value),\r\n        productoId: parseInt(inputProductoId.value),\r\n        cantidad: parseInt(inputCantidad.value),\r\n        subtotal: parseFloat(inputSubtotal.value),\r\n    };\r\n\r\n    try {\r\n        const method = id ? \"PUT\" : \"POST\";\r\n        const url = id ? `${apiUrl}/${id}` : apiUrl;\r\n\r\n        const res = await fetch(url, {\r\n            method,\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify(data),\r\n        });\r\n\r\n        if (!res.ok) throw new Error(`Error en ${method}`);\r\n\r\n        resetForm();\r\n        await loadDetalles();\r\n    } catch (error) {\r\n        console.error(\"Error guardando detalle:\", error);\r\n    }\r\n}\r\n\r\nfunction editDetalle(detalle: DetalleVenta): void {\r\n    inputId.value = detalle.detalleVentaId.toString();\r\n    inputVentaId.value = detalle.ventaId.toString();\r\n    inputProductoId.value = detalle.productoId.toString();\r\n    inputCantidad.value = detalle.cantidad.toString();\r\n    inputSubtotal.value = detalle.subtotal.toString();\r\n}\r\n\r\nasync function deleteDetalle(id: number): Promise<void> {\r\n    if (!confirm(\"\uFFFDEst\uFFFDs seguro de eliminar este detalle?\")) return;\r\n\r\n    try {\r\n        const res = await fetch(`${apiUrl}/${id}`, { method: \"DELETE\" });\r\n        if (!res.ok) throw new Error(\"Error al eliminar detalle\");\r\n        await loadDetalles();\r\n    } catch (error) {\r\n        console.error(\"Error eliminando detalle:\", error);\r\n    }\r\n}\r\n\r\nfunction resetForm(): void {\r\n    form.reset();\r\n    inputId.value = \"\";\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
